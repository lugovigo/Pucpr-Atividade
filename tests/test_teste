from src.Main import *
from unittest.mock import patch
from fastapi.testclient import TestClient

client = TestClient(app)

def test_root():
    response = client.get("/")
    assert response.status_code == 200
    assert response.json() == {"message": "Hello World"}

def test_functeste():
    response = client.get("/teste01")
    assert response.status_code == 200
    assert response.json() == {"message": "teste o k a "}

def test_functeste02():
    with patch('random.randint', return_value=666):
        response = client.get("/teste02")
        assert response.status_code == 200
        assert response.json() == {"teste": True, "num_aleatorio": 666}

def test_criar_usuario():
    response = client.post("/usuarios", json={"id": 1, "nome": "Alice", "email": "alice@email.com"})
    assert response.status_code == 200
    assert response.json() == {"id": 1, "nome": "Alice", "email": "alice@email.com"}

def test_obter_usuario():
    client.post("/usuarios", json={"id": 2, "nome": "Bob", "email": "bob@email.com"})
    response = client.get("/usuarios/2")
    assert response.status_code == 200
    assert response.json()["nome"] == "Bob"

def test_atualizar_usuario():
    client.post("/usuarios", json={"id": 3, "nome": "Carol", "email": "carol@email.com"})
    response = client.put("/usuarios/3", json={"id": 3, "nome": "Carol Updated", "email": "new@email.com"})
    assert response.status_code == 200
    assert response.json()["nome"] == "Carol Updated"

def test_deletar_usuario():
    client.post("/usuarios", json={"id": 4, "nome": "Dan", "email": "dan@email.com"})
    response = client.delete("/usuarios/4")
    assert response.status_code == 200
    assert response.json() == {"message": "Usu√°rio deletado"}